<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chi tiết Phòng - Hệ thống Khách sạn</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f3f4f6;
        color: #1f2937;
        line-height: 1.6;
      }

      .header {
        background: white;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding: 16px 24px;
        margin-bottom: 24px;
        border-radius: 8px;
      }

      .room-detail-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .room-header {
        position: relative;
        height: 400px;
        overflow: hidden;
      }

      .room-header img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .room-badge {
        position: absolute;
        top: 20px;
        left: 20px;
        background: #2563eb;
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
      }

      .room-status {
        position: absolute;
        top: 20px;
        right: 20px;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
      }

      .status-empty {
        background: #dcfce7;
        color: #166534;
      }

      .status-booked {
        background: #fef3c7;
        color: #92400e;
      }

      .status-using {
        background: #dbeafe;
        color: #1e40af;
      }

      .status-cleaning {
        background: #fef3c7;
        color: #92400e;
      }

      .status-maintaining {
        background: #fef2f2;
        color: #dc2626;
      }

      .detail-section {
        background: #f9fafb;
        padding: 24px;
        border-radius: 8px;
        height: 100%;
      }

      .detail-section-title {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 20px;
        padding-bottom: 12px;
        border-bottom: 2px solid #e5e7eb;
      }

      .detail-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #f3f4f6;
      }

      .detail-label {
        color: #6b7280;
        font-weight: 500;
      }

      .detail-value {
        color: #1f2937;
        font-weight: 600;
      }

      .detail-price {
        color: #2563eb;
        font-weight: 600;
      }

      .amenity-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        background: #f0f9ff;
        border-radius: 8px;
        border-left: 4px solid #2563eb;
      }

      .amenity-item i {
        color: #2563eb;
        font-size: 18px;
      }

      .gallery-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .gallery-image:hover {
        transform: scale(1.05);
      }

      .action-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        text-decoration: none;
      }

      @media (max-width: 768px) {
        .room-header {
          height: 250px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container py-4">
      <!-- Header -->
      <header class="header">
        <div class="d-flex justify-content-between align-items-center">
          <h1 class="h3 mb-0">Chi tiết Phòng</h1>
          <a href="/rooms" class="btn btn-primary">
            <i class="fas fa-arrow-left me-2"></i>
            Quay lại danh sách
          </a>
        </div>
      </header>

      <!-- Room Detail -->
      <div class="room-detail-card">
        <!-- Room Header with Image -->
        <div class="room-header">
          <img src="<%= room.HinhAnh[0].ImgURL %>" alt="<%= room.TenPhong %>" />
          <div class="room-badge"><%= room.MaPhong %></div>
          <div class="room-status status-empty">
            <%= room.getCurrentTrangThai() %>
          </div>
        </div>

        <!-- Room Content -->
        <div class="p-4">
          <h1 class="h2 fw-bold mb-3"><%= room.TenPhong %></h1>
          <p class="text-muted mb-4"><%= room.MoTa %></p>

          <!-- Detail Grid -->
          <div class="row mb-4">
            <!-- Basic Information -->
            <div class="col-md-6 mb-3">
              <div class="detail-section">
                <h3 class="detail-section-title">Thông tin cơ bản</h3>
                <div class="detail-item">
                  <span class="detail-label">Mã phòng:</span>
                  <span class="detail-value"><%= room.MaPhong %></span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Loại phòng:</span>
                  <span class="detail-value"
                    ><%= room.LoaiPhong.TenLoaiPhong %></span
                  >
                </div>
                <div class="detail-item">
                  <span class="detail-label">Trạng thái:</span>
                  <span class="detail-value status-empty"
                    ><%= room.getCurrentTrangThai() %></span
                  >
                </div>
                <div class="detail-item">
                  <span class="detail-label">Số giường:</span>
                  <span class="detail-value"><%= room.SoGiuong %> giường</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Sức chứa:</span>
                  <span class="detail-value"><%= room.SucChua %> người</span>
                </div>
              </div>
            </div>

            <!-- Pricing -->
            <div class="col-md-6 mb-3">
              <div class="detail-section">
                <h3 class="detail-section-title">Giá cả</h3>
                <div class="detail-item">
                  <span class="detail-label">Giá theo ngày:</span>
                  <span class="detail-price"
                    ><%= room.getGiaNgayToday().toLocaleString() %> VNĐ</span
                  >
                </div>
                <div class="detail-item">
                  <span class="detail-label">Giá theo giờ:</span>
                  <span class="detail-price"
                    ><%= room.getGiaGioToday().toLocaleString() %> VNĐ</span
                  >
                </div>
                <div class="detail-item">
                  <span class="detail-label">Phí dịch vụ:</span>
                  <span class="detail-value">Bao gồm</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Thuế VAT:</span>
                  <span class="detail-value">10%</span>
                </div>

                <!-- Nút "Xem chi tiết giá" -->
                <div class="mt-3 d-flex justify-content-end color-white">
                  <button
                    type="button"
                    class="btn btn-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#priceDetailModal"
                  >
                    Xem chi tiết giá
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Amenities -->
          <div class="mb-4">
            <h3 class="h4 fw-semibold mb-3">Tiện ích phòng</h3>
            <div class="row g-3">
              <% if(room.TienIch && room.TienIch.length > 0) {
              room.TienIch.forEach((tienIch) => { %>
              <div class="col-sm-6 col-md-4 col-lg-3">
                <div class="amenity-item">
                  <i class="fas <%= tienIch.IconURL %>"></i>
                  <span><%= tienIch.TenTienIch %></span>
                </div>
              </div>
              <% })} %>
            </div>
          </div>

          <!-- Danh sách ảnh phòng -->
          <div class="mb-4">
            <h3 class="h4 fw-semibold mb-3">Hình ảnh phòng</h3>
            <div class="row g-3">
              <% if(room.HinhAnh && room.HinhAnh.length > 0) {
              room.HinhAnh.forEach((hinhAnh, index) => { %>
              <div class="col-sm-6 col-md-4 col-lg-3">
                <img
                  src="<%= hinhAnh.ImgURL %>"
                  alt="Hình ảnh phòng <%= room.TenPhong %> <%= index + 1 %>"
                  class="gallery-image"
                />
              </div>
              <% })} %>
            </div>
          </div>

          <!-- Modal xem ảnh lớn -->
          <div class="modal fade" id="imageModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered modal-lg">
              <div class="modal-content bg-transparent border-0 shadow-none">
                <img id="modalImage" class="w-100 rounded" />
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div
            class="d-flex flex-column flex-md-row justify-content-md-end gap-3 pt-4 border-top"
          >
            <button class="btn btn-outline-success action-btn">
              <i class="fas fa-edit me-2"></i>
              Chỉnh sửa
            </button>
            <button
              class="btn btn-outline-danger action-btn"
              onclick="showDeleteModal('<%= room.MaPhong %>','<%= room.TenPhong %>')"
            >
              <i class="fas fa-trash me-2"></i>
              Xóa phòng
            </button>
            <!-- <button class="btn btn-primary action-btn">
              <i class="fas fa-calendar-check me-2"></i>
              Đặt phòng ngay
            </button> -->
          </div>
        </div>
      </div>

      <!-- Modal xem chi tiết giá -->
      <div class="modal fade" id="priceDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content shadow-lg border-0">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title">
                <i class="fas fa-tags me-2"></i> Chi tiết giá phòng
              </h5>
              <button
                type="button"
                class="btn-close btn-close-white"
                data-bs-dismiss="modal"
              ></button>
            </div>

            <div class="modal-body p-4">
              <!-- Giá theo ngày trong tuần -->
              <h5 class="mb-3">
                <i class="fas fa-calendar-week text-primary me-2"></i> Giá theo
                từng ngày
              </h5>

              <div class="table-responsive mb-4">
                <table class="table table-bordered align-middle">
                  <thead class="table-light">
                    <tr>
                      <th>Thứ</th>
                      <th>Giá ngày (VND)</th>
                      <th>Giá giờ (VND)</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% if(room.GiaPhongTuan && room.GiaPhongTuan.length >0) {
                    room.GiaPhongTuan.forEach(gia => { %>
                    <tr>
                      <td>
                        <%= gia.ThuApDung === 8 ? 'Chủ nhật' : `Thứ
                        ${gia.ThuApDung}` %>
                      </td>
                      <td><%= gia.GiaNgay.toLocaleString() %> VNĐ</td>
                      <td>
                        <%= gia.GiaGio ? gia.GiaGio.toLocaleString() : "-" %>
                        VNĐ
                      </td>
                    </tr>
                    <% }) } %>
                  </tbody>
                </table>
              </div>

              <!-- Giá theo ngày lễ -->
              <h5 class="mb-3">
                <i class="fas fa-gift text-danger me-2"></i> Giá ngày lễ
              </h5>

              <% if(room.GiaPhongNgayLe && room.GiaPhongNgayLe.length > 0) { %>
              <div class="list-group mb-3">
                <% room.GiaPhongNgayLe.forEach(le => { %>
                <div
                  class="list-group-item d-flex justify-content-between align-items-center"
                >
                  <div>
                    <strong class="text-danger"><%= le.NgayLe %></strong><br />
                    <small class="text-muted">
                      <%= le.NgayBatDau %> - <%= le.NgayKetThuc %>
                    </small>
                  </div>
                  <span class="fw-bold text-danger">
                    Giá ngày: <%= le.GiaNgay.toLocaleString() %> VNĐ - Giá giờ:
                    <%= le.GiaGio ? le.GiaGio.toLocaleString() : "-" %> VNĐ
                  </span>
                </div>
                <% }) %>
              </div>
              <% } else { %>
              <p class="text-muted fst-italic">
                Không có ngày lễ cho phòng này.
              </p>
              <% } %>
            </div>

            <div class="modal-footer">
              <button class="btn btn-secondary" data-bs-dismiss="modal">
                Đóng
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal xác nhận xóa -->
      <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Xác nhận xóa</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <p id="deleteMessage">
                Bạn có chắc chắn muốn xóa phòng này không?
              </p>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Hủy
              </button>

              <button type="button" id="confirmDelete" class="btn btn-danger">
                Xóa
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Xử lý mở modal Ảnh khi click vào ảnh
      const modalImage = document.getElementById("modalImage");
      const imageModal = new bootstrap.Modal(
        document.getElementById("imageModal")
      );

      document.querySelectorAll(".gallery-image").forEach((img) => {
        img.addEventListener("click", () => {
          modalImage.src = img.src; // Gán ảnh vào modal
          imageModal.show(); // Mở modal
        });
      });

      // Mở modal xác nhận xóa
      function showDeleteModal(roomId, roomName) {
        currentRoomToDelete = roomId;
        document.getElementById(
          "deleteMessage"
        ).textContent = `Bạn có chắc chắn muốn xóa phòng "${roomName}"? Hành động này không thể hoàn tác.`;
        const deleteModal = new bootstrap.Modal(
          document.getElementById("deleteModal")
        );
        deleteModal.show();
      }

      // Delete Confirmation
      document
        .getElementById("confirmDelete")
        .addEventListener("click", deleteRoom);

      async function deleteRoom() {
        if (currentRoomToDelete) {
          // Gửi yêu cầu xóa đến server
          const res = await fetch(`/rooms/${currentRoomToDelete}`, {
            method: "DELETE",
          }).catch((error) => {
            console.error("Error:", error);
            alert("Có lỗi xảy ra khi xóa phòng");
          });

          const data = await res.json();

          if (data.success) {
            alert(data.message);
            location.replace("/rooms");
          } else {
            alert("Xóa thất bại!");
          }
        }
      }
    </script>
  </body>
</html>
